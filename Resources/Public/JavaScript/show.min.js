(function(){"use strict";let reasonWrapperClass=".wrapper-reason",savedRatingAlertClass=".saved-rating-alert",extensionName="tx_partnerrating",pluginName="_pi1",partnerSearchName="partnerSearch",ratingName="rating",partnerName="partner",rateValueName="rateValue",reasonName="reason",reasonTextName="reasonText",form=null,searchInput=null,partnerSelect=null,textareaField=null,reasonWrapper=null,reasonOptions=null,radioRating=null,savedRatingAlert=null,ratingValue=0,emptyOptionSelected=false,ratingReasonMinValue=0,keepMinOneSearchResult=false,partnerLabelFields="",partnerLabelFieldSplitString="",allowMultipleReasons=false;function updatePartnerSelect(){const searchText=searchInput.value;const formData=new FormData;formData.append("searchText",searchText);formData.append("partnerLabelFields",partnerLabelFields);fetch("/",{method:"POST",body:formData}).then(response=>response.json()).then(data=>{if(partnerSelect&&(data.length>0||!keepMinOneSearchResult)){const previouslySelectedValue=parseInt(partnerSelect.value,10);while(partnerSelect.options.length>1){partnerSelect.remove(1)}let matchFound=false;data.forEach(option=>{if(option.uid===previouslySelectedValue){option.selected=true;matchFound=true}addOption(option)});if(!matchFound){partnerSelect.options[0].selected=true;emptyOptionSelected=true}}}).catch(error=>{console.error("Error:",error)})}function addOption(option){const optionElement=document.createElement("option");optionElement.value=option.uid;optionElement.textContent="";partnerLabelFields.split(",").forEach((value,key,array)=>{optionElement.textContent+=option[value];if(!Object.is(array.length-1,key)){optionElement.textContent+=" "+partnerLabelFieldSplitString+" "}});optionElement.selected=option.selected;partnerSelect.appendChild(optionElement)}function updateTextareaStatus(){textareaField.disabled=true;textareaField.required=false;reasonOptions.forEach(option=>{if(option.value==="-1"&&option.checked){textareaField.disabled=false;textareaField.required=true}})}function handleRatingSelectChange(){radioRating.forEach(radio=>{if(radio.checked){ratingValue=parseInt(radio.value,10)}});reasonOptions.forEach(option=>{if(!allowMultipleReasons){option.required=true}if(option.checked&&parseInt(option.value,10)===0){const customValidationMessage=reasonWrapper.getAttribute("data-validation");option.setCustomValidity(customValidationMessage)}else{option.setCustomValidity("")}});if(!allowMultipleReasons){if(ratingReasonMinValue!==0&&ratingValue>ratingReasonMinValue){reasonOptions.forEach(option=>{option.required=true})}else{reasonOptions.forEach(option=>{option.required=false;option.setCustomValidity("")})}}}function handleFormSubmit(event){if(!event.target.checkValidity()){event.preventDefault()}checkSelectedPartner(event);checkReasonOptions(event)}function checkSelectedPartner(event){partnerSelect.setCustomValidity("");const selectedPartnerValue=parseInt(partnerSelect.value,10);if(isNaN(selectedPartnerValue)||selectedPartnerValue===0){const customValidationMessage=partnerSelect.getAttribute("data-validation");partnerSelect.setCustomValidity(customValidationMessage);event.preventDefault();form.reportValidity()}}function checkReasonOptions(event){let checkboxChecked=false;reasonOptions.forEach(checkbox=>{if(checkbox.checked){checkboxChecked=true}});reasonOptions.forEach(checkbox=>{checkbox.setCustomValidity("")});if(ratingReasonMinValue!==0&&ratingValue>ratingReasonMinValue&&!checkboxChecked&&textareaField.value===""){const customValidationMessage=reasonWrapper.getAttribute("data-validation");reasonOptions[0].setCustomValidity(customValidationMessage);event.preventDefault();form.reportValidity()}}function handlePartnerSelectChange(){const selectedPartnerValue=parseInt(partnerSelect.value,10);if(selectedPartnerValue===0){const customValidationMessage=partnerSelect.getAttribute("data-validation");partnerSelect.setCustomValidity(customValidationMessage)}else{partnerSelect.setCustomValidity("")}}function hideAlertTimeout(){setTimeout(function(){savedRatingAlert.classList.remove("show");savedRatingAlert.classList.add("d-none");searchInput.focus()},3e3)}document.addEventListener("DOMContentLoaded",function(){const container=document.querySelector("."+extensionName);if(!container){console.error("DOM elements not found.");return}form=container.querySelector("form");if(form.hasAttribute("data-ratingreasonminvalue")){ratingReasonMinValue=parseInt(form.getAttribute("data-ratingreasonminvalue"),10)}if(form.hasAttribute("data-keepminonesearchresult")){keepMinOneSearchResult=form.getAttribute("data-keepminonesearchresult")==="1"}if(form.hasAttribute("data-partnerlabelfields")){partnerLabelFields=form.getAttribute("data-partnerlabelfields")}if(form.hasAttribute("data-partnerlabelfieldsplitstring")){partnerLabelFieldSplitString=form.getAttribute("data-partnerlabelfieldsplitstring")}if(form.hasAttribute("data-allowmultiplereasons")){allowMultipleReasons=form.getAttribute("data-allowmultiplereasons")==="1"}reasonWrapper=container.querySelector(reasonWrapperClass);searchInput=container.querySelector('[name="'+extensionName+pluginName+"["+partnerSearchName+']"]');partnerSelect=container.querySelector('[name="'+extensionName+pluginName+"["+ratingName+"]["+partnerName+']"]');radioRating=container.querySelectorAll('[name="'+extensionName+pluginName+"["+ratingName+"]["+rateValueName+']"]');textareaField=container.querySelector('[name="'+extensionName+pluginName+"["+ratingName+"]["+reasonTextName+']"]');savedRatingAlert=container.querySelector(savedRatingAlertClass);if(allowMultipleReasons){reasonOptions=reasonWrapper.querySelectorAll('[name="'+extensionName+pluginName+"["+ratingName+"]["+reasonName+'][]"]')}else{reasonOptions=reasonWrapper.querySelectorAll('[name="'+extensionName+pluginName+"["+ratingName+"]["+reasonName+']"]')}if(searchInput&&partnerSelect){searchInput.addEventListener("input",updatePartnerSelect);updatePartnerSelect();searchInput.focus()}if(textareaField){textareaField.addEventListener("input",checkReasonOptions)}if(reasonOptions&&textareaField&&!allowMultipleReasons){reasonOptions.forEach(option=>{option.addEventListener("change",updateTextareaStatus)});updateTextareaStatus()}if(radioRating&&reasonOptions){reasonOptions.forEach(radio=>{radio.addEventListener("change",handleRatingSelectChange)});radioRating.forEach(radio=>{radio.addEventListener("change",handleRatingSelectChange)});handleRatingSelectChange()}if(radioRating&&reasonOptions&&partnerSelect){reasonOptions.forEach(radio=>{radio.addEventListener("change",handlePartnerSelectChange)})}if(partnerSelect){partnerSelect.addEventListener("change",handlePartnerSelectChange);handlePartnerSelectChange()}if(form){form.addEventListener("submit",handleFormSubmit)}if(searchInput&&savedRatingAlert){hideAlertTimeout()}})})();